# train_refæ¨¡å—è‡ªåŠ¨åŒ–UIæµ‹è¯•

## Why

### é—®é¢˜èƒŒæ™¯

train_refæ¨¡å—å·²å®Œæˆå®Œå…¨é‡æ„å¹¶åˆå¹¶åˆ°mainåˆ†æ”¯(commit 6ec36c0),ä»£ç ä»15,049è¡Œç²¾ç®€åˆ°10,800è¡Œã€‚è™½ç„¶å·²å®Œæˆ:
- âœ… å•å…ƒæµ‹è¯•(æ ¸å¿ƒå±‚89%ã€åˆ†æå±‚91%ã€å·¥å…·å±‚82%è¦†ç›–ç‡)
- âœ… æ•°å€¼ä¸€è‡´æ€§éªŒè¯(13/13æ ¸å¿ƒç®—æ³•æµ‹è¯•é€šè¿‡)
- âœ… åŸºç¡€UIé›†æˆæµ‹è¯•(Phase 6.3å•æ¬¡éªŒè¯)

ä½†**ç¼ºå°‘ç³»ç»ŸåŒ–çš„å‚æ•°ç»„åˆæµ‹è¯•**,å­˜åœ¨ä»¥ä¸‹é£é™©:

### æµ‹è¯•è¦†ç›–ç¼ºå£

1. **å‚æ•°ç»„åˆä¸å…¨**: Phase 6.3ä»…æµ‹è¯•äº†å•ä¸€å‚æ•°é…ç½®(k=10, å˜é‡é€‰æ‹©=global_backward, BIC)
2. **è¾¹ç•Œæƒ…å†µæœªè¦†ç›–**:
   - æå°å› å­æ•°(k=1,2)
   - æå¤§å› å­æ•°(k=15,20)
   - ä¸åŒå˜é‡é€‰æ‹©æ–¹æ³•(forward/backward/none)
   - ä¸åŒå› å­é€‰æ‹©æ–¹æ³•(fixed/cumulative/elbow)
3. **ç¼ºå°‘å›å½’éªŒè¯**: æœªå»ºç«‹è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•æœºåˆ¶,æ— æ³•å¿«é€ŸéªŒè¯æœªæ¥ä¿®æ”¹
4. **åå°è¾“å‡ºæœªç›‘æ§**: è®­ç»ƒè¿‡ç¨‹çš„åå°æ‰“å°è¾“å‡ºæœªè¢«æ£€æŸ¥,å¯èƒ½éšè—è­¦å‘Šæˆ–é”™è¯¯

### ä¸ºä»€ä¹ˆéœ€è¦Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•

1. **ç«¯åˆ°ç«¯éªŒè¯**: ä»UIä¸Šä¼ æ•°æ®â†’data_prepé¢„å¤„ç†â†’æ¨¡å‹è®­ç»ƒâ†’ç»“æœå±•ç¤ºçš„å®Œæ•´æµç¨‹
2. **çœŸå®ç¯å¢ƒ**: æµ‹è¯•å®é™…çš„Streamlitåº”ç”¨,ä¸æ˜¯æ¨¡æ‹Ÿç¯å¢ƒ
3. **åå°ç›‘æ§**: Playwrightå¯æ•è·æ§åˆ¶å°è¾“å‡º,å‘ç°éšè—é—®é¢˜
4. **å¯é‡å¤æ€§**: è‡ªåŠ¨åŒ–æµ‹è¯•å¯å¿«é€Ÿå›å½’,ä¿éšœä»£ç è´¨é‡

### æµ‹è¯•ä»·å€¼

é€šè¿‡ç³»ç»ŸåŒ–å‚æ•°ç»„åˆæµ‹è¯•,å¯ä»¥:
- ğŸ” **å‘ç°æ½œåœ¨é—®é¢˜**: ç‰¹å®šå‚æ•°ç»„åˆä¸‹çš„å´©æºƒã€å¼‚å¸¸ã€æ•°å€¼é”™è¯¯
- ğŸ“Š **éªŒè¯å¥å£®æ€§**: ç¡®ä¿å„ç§åˆç†å‚æ•°é…ç½®éƒ½èƒ½æ­£å¸¸å·¥ä½œ
- ğŸš€ **å»ºç«‹è´¨é‡åŸºçº¿**: ä¸ºæœªæ¥ä¿®æ”¹æä¾›å›å½’æµ‹è¯•ä¿éšœ
- ğŸ“ **ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š**: è®°å½•æ‰€æœ‰å‚æ•°ç»„åˆçš„è®­ç»ƒç»“æœå’Œæ€§èƒ½æŒ‡æ ‡

## What Changes

### æ ¸å¿ƒå˜æ›´

åˆ›å»º**ç³»ç»ŸåŒ–çš„Playwrightè‡ªåŠ¨åŒ–UIæµ‹è¯•å¥—ä»¶**,ä½¿ç”¨çœŸå®æ•°æ®(`ç»æµæ•°æ®åº“1017.xlsx`)æµ‹è¯•train_refæ¨¡å—åœ¨ä¸åŒå‚æ•°é…ç½®ä¸‹çš„å®Œæ•´è®­ç»ƒæµç¨‹ã€‚

### æµ‹è¯•èŒƒå›´

#### 1. æ•°æ®å‡†å¤‡(data_prep)è‡ªåŠ¨åŒ–

- ä¸Šä¼ Excelæ–‡ä»¶(`ç»æµæ•°æ®åº“1017.xlsx`)
- è®¾ç½®å¼€å§‹æ—¥æœŸä¸º2020-01-01
- å…¶ä»–å‚æ•°ä½¿ç”¨é»˜è®¤å€¼
- éªŒè¯æ•°æ®åŠ è½½æˆåŠŸ

#### 2. å‚æ•°ç»„åˆæµ‹è¯•çŸ©é˜µ(10ä¸ªå·¦å³é¢„æµ‹å˜é‡)

æµ‹è¯•ä»¥ä¸‹å‚æ•°ç»„åˆ(å…±12-15ä¸ªæµ‹è¯•ç”¨ä¾‹):

| æµ‹è¯•ID | å˜é‡æ•° | å˜é‡é€‰æ‹© | å› å­é€‰æ‹©æ–¹æ³• | å› å­æ•°(k) | EMè¿­ä»£ | è¯´æ˜ |
|--------|-------|---------|-------------|----------|--------|------|
| T1 | 10 | ç¦ç”¨ | fixed | 2 | 30 | åŸºçº¿:å°å› å­æ•° |
| T2 | 10 | ç¦ç”¨ | fixed | 3 | 30 | åŸºçº¿:ä¸­å› å­æ•° |
| T3 | 10 | ç¦ç”¨ | fixed | 5 | 30 | åŸºçº¿:å¤§å› å­æ•° |
| T4 | 10 | ç¦ç”¨ | cumulative | auto(0.85é˜ˆå€¼) | 30 | PCAè‡ªåŠ¨é€‰æ‹© |
| T5 | 10 | ç¦ç”¨ | cumulative | auto(0.90é˜ˆå€¼) | 30 | PCAé«˜é˜ˆå€¼ |
| T6 | 10 | ç¦ç”¨ | elbow | auto | 30 | Elbowæ–¹æ³• |
| T7 | 12 | backward | fixed | 3 | 30 | å˜é‡é€‰æ‹©+å›ºå®šå› å­ |
| T8 | 12 | backward | cumulative | auto(0.85) | 30 | å˜é‡é€‰æ‹©+PCA |
| T9 | 10 | ç¦ç”¨ | fixed | 1 | 30 | è¾¹ç•Œ:å•å› å­ |
| T10 | 10 | ç¦ç”¨ | fixed | 10 | 30 | è¾¹ç•Œ:é«˜ç»´å› å­ |
| T11 | 10 | ç¦ç”¨ | fixed | 3 | 10 | EMè¿­ä»£å°‘ |
| T12 | 10 | ç¦ç”¨ | fixed | 3 | 50 | EMè¿­ä»£å¤š |

**é¢„æœŸæ‰©å±•**: æ ¹æ®æ‰§è¡Œç»“æœ,å¯èƒ½å¢åŠ forwardå˜é‡é€‰æ‹©ã€æ›´å¤šPCAé˜ˆå€¼ç­‰

#### 3. éªŒè¯å†…å®¹

å¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹,éªŒè¯:

1. **è®­ç»ƒæˆåŠŸå®Œæˆ**
   - æ— Pythonå¼‚å¸¸æˆ–å´©æºƒ
   - è®­ç»ƒçŠ¶æ€æ˜¾ç¤º"completed"
   - ç»“æœæ‘˜è¦æ­£ç¡®å±•ç¤º

2. **ç»“æœåˆç†æ€§**
   - RMSE > 0
   - Hit Rateåœ¨[0,1]åŒºé—´
   - ç›¸å…³ç³»æ•°åœ¨[-1,1]åŒºé—´
   - é€‰å®šå˜é‡æ•° â‰¤ åˆå§‹å˜é‡æ•°
   - é€‰å®šå› å­æ•°ç¬¦åˆé…ç½®

3. **åå°è¾“å‡ºç›‘æ§**
   - æ•è·æ‰€æœ‰console.log/printè¾“å‡º
   - æ£€æŸ¥ERRORå…³é”®å­—
   - æ£€æŸ¥WARNINGå…³é”®å­—
   - è®°å½•EMæ”¶æ•›ä¿¡æ¯

4. **æ€§èƒ½æŒ‡æ ‡**
   - è®°å½•è®­ç»ƒç”¨æ—¶
   - è®°å½•æ•°æ®é¢„å¤„ç†ç”¨æ—¶
   - ç”Ÿæˆæ€§èƒ½å¯¹æ¯”æŠ¥å‘Š

### æ–°å¢æ–‡ä»¶

```
dashboard/DFM/train_ref/tests/ui/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ test_training_param_combinations.py  # ä¸»æµ‹è¯•å¥—ä»¶(Playwright)
â”œâ”€â”€ test_data_prep_automation.py         # æ•°æ®å‡†å¤‡è‡ªåŠ¨åŒ–æµ‹è¯•
â”œâ”€â”€ conftest.py                          # Pytesté…ç½®å’Œfixtures
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ playwright_helpers.py            # Playwrightå·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ console_monitor.py               # æ§åˆ¶å°è¾“å‡ºç›‘æ§
â”‚   â””â”€â”€ test_report_generator.py         # æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå™¨
â””â”€â”€ test_results/                        # æµ‹è¯•ç»“æœè¾“å‡ºç›®å½•
    â”œâ”€â”€ test_report.html                 # HTMLæµ‹è¯•æŠ¥å‘Š
    â”œâ”€â”€ test_summary.json                # JSONæ±‡æ€»æ•°æ®
    â””â”€â”€ screenshots/                     # å¤±è´¥æˆªå›¾
```

## Impact

### å½±å“çš„è§„èŒƒ

- **ui-test-automation** (æ–°å¢): DFMæ¨¡å—UIè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½åŠ›è§„èŒƒ
- **dfm-model-training**: è¡¥å……è‡ªåŠ¨åŒ–æµ‹è¯•éªŒæ”¶æ ‡å‡†

### å½±å“çš„ä»£ç 

**æ–°å¢ä»£ç ** (~1,200è¡Œ):
- `tests/ui/test_training_param_combinations.py`: ä¸»æµ‹è¯•å¥—ä»¶(~400è¡Œ)
- `tests/ui/test_data_prep_automation.py`: æ•°æ®å‡†å¤‡æµ‹è¯•(~200è¡Œ)
- `tests/ui/conftest.py`: Pytesté…ç½®(~150è¡Œ)
- `tests/ui/utils/playwright_helpers.py`: å·¥å…·å‡½æ•°(~200è¡Œ)
- `tests/ui/utils/console_monitor.py`: æ§åˆ¶å°ç›‘æ§(~150è¡Œ)
- `tests/ui/utils/test_report_generator.py`: æŠ¥å‘Šç”Ÿæˆ(~100è¡Œ)

**ä¿®æ”¹ä»£ç ** (å¯é€‰,è§†æµ‹è¯•å‘ç°çš„é—®é¢˜è€Œå®š):
- `dashboard/ui/pages/dfm/model_training_page.py`: å¦‚å‘ç°UIé—®é¢˜éœ€ä¿®å¤
- `dashboard/DFM/train_ref/training/trainer.py`: å¦‚å‘ç°è®­ç»ƒé€»è¾‘é—®é¢˜éœ€ä¿®å¤

**æ— åˆ é™¤ä»£ç **

### ä¾èµ–é¡¹

æ–°å¢æµ‹è¯•ä¾èµ–(å·²åœ¨é¡¹ç›®ä¸­å¯ç”¨):
- `playwright` (é€šè¿‡MCPå·²é›†æˆ)
- `pytest-playwright` (å¦‚æœªå®‰è£…éœ€æ·»åŠ )
- `pytest-html` (æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ)

### é£é™©ä¸ç¼“è§£

**é£é™©**:
1. **æµ‹è¯•æ‰§è¡Œæ—¶é—´é•¿**: 12-15ä¸ªç”¨ä¾‹,æ¯ä¸ª~3åˆ†é’Ÿ,æ€»è®¡~45åˆ†é’Ÿ
   - **ç¼“è§£**: æä¾›å¿«é€Ÿæ¨¡å¼(ä»…æµ‹è¯•3ä¸ªæ ¸å¿ƒç”¨ä¾‹)
2. **Streamlitåº”ç”¨ä¸ç¨³å®š**: æµ‹è¯•å¯èƒ½å› UIåŠ è½½é—®é¢˜å¤±è´¥
   - **ç¼“è§£**: æ·»åŠ æ™ºèƒ½ç­‰å¾…å’Œé‡è¯•æœºåˆ¶
3. **æµ‹è¯•å‘ç°å¤§é‡é—®é¢˜**: å¯èƒ½éœ€è¦é¢å¤–ä¿®å¤æ—¶é—´
   - **ç¼“è§£**: åˆ†é˜¶æ®µä¿®å¤,ä¼˜å…ˆä¿®å¤é˜»å¡æ€§é—®é¢˜

### é¢„æœŸæ”¶ç›Š

1. **è´¨é‡ä¿éšœ**: å»ºç«‹è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•æœºåˆ¶,é˜²æ­¢æœªæ¥ä¿®æ”¹å¼•å…¥bug
2. **å‚æ•°éªŒè¯**: ç¡®è®¤æ‰€æœ‰åˆç†å‚æ•°ç»„åˆéƒ½èƒ½æ­£å¸¸å·¥ä½œ
3. **é—®é¢˜å‘ç°**: é€šè¿‡åå°è¾“å‡ºç›‘æ§å‘ç°éšè—é—®é¢˜
4. **æ–‡æ¡£ä»·å€¼**: æµ‹è¯•ç”¨ä¾‹å³æ–‡æ¡£,å±•ç¤ºå„å‚æ•°é…ç½®çš„ä½¿ç”¨æ–¹æ³•
5. **CI/CDé›†æˆ**: ä¸ºæœªæ¥çš„æŒç»­é›†æˆæä¾›åŸºç¡€

### äº¤ä»˜ç‰©

1. å®Œæ•´çš„Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
2. HTMLæµ‹è¯•æŠ¥å‘Š(åŒ…å«æ‰€æœ‰å‚æ•°ç»„åˆçš„ç»“æœ)
3. é—®é¢˜æ¸…å•(å¦‚å‘ç°ä»»ä½•é—®é¢˜)
4. æµ‹è¯•æ‰§è¡ŒæŒ‡å—(README.md)
